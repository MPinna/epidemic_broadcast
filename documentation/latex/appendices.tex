%-------------------------------------------------------------------------------
% File: appendicies.tex
%       Epidemic Broadcast project documentation.
%
% Author: Marco Pinna, Rambod Rahmani, Yuri Mazzuoli
%         Created on 05/12/2020
%-------------------------------------------------------------------------------
\chapter{Appendices}
%\section*{Appendix A}
%\label{app:a}
%Given a scenario with $N$ transmitter devices and one target device $T$ in reach
%by all of the transmitter devices, let us define the probabilities $P_{1}(j, N)$
%as the probability of $j$ devices out of $N$ transmitting at the same time
%during the time slot $1$ and $P_{i}(j)$ as the probability of $j$ devices
%transmitting at the same time during slot $i$.\\
%By specification, the successful reception of the message by device $T$ occurs
%when \textbf{one} and only one of the transmitters sends the message during the
%time slot. Furthermore, the successful transmission of a device is
%``\textit{a Bernoullian RV with success probability \emph{p} on every slot, until
%it achieves success}". Therefore, we can model $P_{1}(j, N)$ as follows:
%\[
%\begin{drcases}
%    &P_{1}(0, N) = (1-p)^{N} \\
%    &P_{1}(1, N) = N p(1-p)^{N-1}\\
%    &P_{1}(2, N) = {N\choose2}p^{2}(1-p)^{N-2}\\
%    &P_{1}(3, N) = {N\choose3}p^{3}(1-p)^{N-3}\\
%    &...\\
%    &P_{1}(N-1, N) = {N\choose N-1}p^{N-1}(1-p)\\
%    &P_{1}(N, N) = {N\choose N}p^{N}\\
%\end{drcases}
%P_{1}(j, N) = {N\choose j} p^{j} (1-p)^{N-j}
%\]
%As for $P_{i}(j)$ we can model the system as if it was in the first time slot,
%with the total number of active devices now being equal to $N - t$, where
%$t$ is the number of devices that have transmitted in the $(i - 1)$-th slot.\\

\section*{Appendix A}
\label{app:a}
An example of stochastic matrix for a system with $N = 5$ and $p = 0.4$:
\begin{equation*}
P = 
\begin{bmatrix}
P_{0,0}	& P_{0,2}	& P_{0,3}  	& P_{0, 4}	& P_{0,S}	& P_{0,5} \\
		& P_{2,2}	& 0  		& P_{2, 4}	& P_{2,S}	& P_{2,5} \\
		& 			& P_{3,3}	& 0			& P_{3,S}	& P_{3,5} \\
		& 			& 			& P_{4,4}	& P_{4,S}	& 0\\
		& 			& 			& 			& 1			& 0\\
0		& 			& 		  	& 			& 			& 1\\
\end{bmatrix}
\label{exampleMatrix}
\end{equation*}
Here with numerical values (rounded to 4 decimal places):

%P = 
%\begin{bmatrix}
%0.0778	& 0.3456	& 0.2304  	& 0.0768	& 0.2592	& 0.0102 \\
%		& 0.216		& 0  		&0.288		& 0.432		& 0.064 \\
%		& 			& 0.36		& 0			& 0.48		& 0.16 \\
%		& 			& 			& 0.6		& 0.4		& 0\\
%		& 			& 			& 			& 1			& 0\\
%0		& 			& 		  	& 			& 			& 1\\
%\end{bmatrix}

\begin{equation*}
P=
\begin{blockarray}{ccccccc}
 & 0 & 2 & 3 & 4 & S & 5 \\
\begin{block}{c[cccccc]}
0	&	0.0778	& 0.3456	& 0.2304  	& 0.0768	& 0.2592	& 0.0102 \\
2	&			& 0.216		& 0  		&0.288		& 0.432		& 0.064 \\
3	&			& 			& 0.36		& 0			& 0.48		& 0.16 \\
4	&			& 			& 			& 0.6		& 0.4		& 0\\
S	&			& 			& 			& 			& 1			& 0\\
5	&	0		& 			& 		  	& 			& 			& 1\\
\end{block}
\end{blockarray}
\label{exampleMatrixValues}
\end{equation*}
\newpage
% \section*{Appendix B}
% \label{app:b}
% %TODO
% Given a generic convex shape as floorplan, we can compute its area ($A$). If we
% imagine randomly placing a point mass transmitter (\texttt{trx}) in the floorplan we can define its transmission circle as the circle centered in \texttt{trx} with a radius $R$ equal to the transmission range of the first. If the \texttt{trx}
% in far enough from the border of the floorplan, its whole transmission circle lies
% onto the floorplan. In this case, the probability for another (random
% positioned) \texttt{trx} to be placed within the circle is equal to:
% \begin{equation*}
%     \frac{2\pi R^2}{A} \ 
% \end{equation*}
% If the first \texttt{trx} device is placed at a distance less than $R$ from one
% or more borders of the floorplan, the probability of randomly placing a
% \texttt{trx} device in its range is less than in the previous case; this is
% because part of the area of the transmission range will fall out of the
% floorplan and, by construction, \texttt{trx} devices cannot be placed there. 
% Depending on the shape of the floorplan, we can identify the partition of the shape
% where the transmission range will fall out of the shape itself and compute the area of this partition.\\
% In general, by the middle value theorem for integrals, and the total probability
% theorem, the probability for $2$ transmitters (let $x$ and $y$ be their
% coordinates) randomly placed to be close enough to be able to communicate is:
% \begin{equation*}
%     \rho = P(|x-y|<r) = \frac{1}{A} \int_{A}^{} P(x')
% \end{equation*}
% Since we know that $P(x')$ is not constant for all the area of the shape, this
% integral might be difficult to compute, even for a square floorplan; in any case
% its value, it is constant for a given floorplan and a given $r$. Taking into
% consideration only one \texttt{trx}, we can compute the probability density
% function for the number of \texttt{trx} in its transmission range, in function
% of the number of \texttt{trx} in the entire floorplan $C(N)$. Every time we put
% a \texttt{trx} in the floorplan, the probability that it falls in the
% transmission range of the highlighted one is $\rho$. This is true for every
% $N > 1$, because of independence.
% \begin{equation*}
%     C(N)= \left(\frac{1}{p}\right)^{\left( N-1 \right)}
% \end{equation*}
% This is a Bernoullian distribution, and we can use this result only taking one
% \texttt{trx} at time; in other words we cannot use this distribution for all the
% \texttt{trx} in a random configured floorplan, because they are not independent. 
% The distribution for one \texttt{trx} will be influenced by the position of
% others. Anyway, we can apply this distribution to many transmitters, each one
% taken from a different floorplan; in this way we can validate the independence
% of different random configurations.
% \newpage
\section*{Appendix B}
\label{app:c}
Below is a demonstration of the upper bound for the number of collision in a scenario with N hosts.

\hfill \break
The necessary condition for a collision to happen is that at least two hosts transmit during the same slot. Each host placed in the intersection of the transmission circles of the two transmitting hosts detects one collision. \\
Therefore, to maximize the number of collisions, it is necessary in every slot, both to a) maximize the number of hosts that detect the collision and b) minimize the number of transmitting hosts (while still assuring that a collision can happen) so that during the next slot the number of hosts available to detect a collision is the highest.

\hfill \break
Let us suppose to have a floorplan with 100 hosts.\\
\begin{enumerate}
	\item
	host 0 transmits and, being the only host transmitting, absence of collision is ensured. Let us suppose that the message is received by host 99 and host 98.
	\item
	host 99 and host 98 broadcast the message and, out of the 97 active hosts, only host 97 and host 96 receive the message correctly. The remaining 95 detect a collision.
	\item
	host 97 and host 96 broadcast the message and, out of the 95 active hosts, only host 95 and host 94 receive the message correctly. The remaining 93 detect a collision.
	\item
	And so on...

\end{enumerate}
\hfill \break
Following this line of reasoning, the number of listening hosts decreases by two every slot, and so does the number of collisions.\\
When only 5 hosts are remaining on the floorplan, 2 of which are transmitting and the other 3 are receiving, 2 of the latter 3 receive the message correctly and the last one detects a collision.\\
Finally, the last 2 out of 3 broadcast the message and the last one detects a collision again.
\hfill \break
The total number of collision is therefore $95+93+91...+3+1\textbf{+1} = 2305$.

\hfill \break
It is trivial to prove that if $N \leq 3$, no collisions can happen.
\hfill \break
In general, for a configuration with N hosts, $N \geq 4$, the upper bound for the number of collision is given by the following formula:

\begin{equation}
\label{eq:collisionUpperBound}
	C_{max}(N) = \begin{cases}
	1+(\frac{N}{2}-2)^2 &\text{if N is even}\\
	2+(\frac{N-1}{2} - 2)(\frac{N-1}{2}-1) &\text{if N is odd}
	\end{cases}
\end{equation}
